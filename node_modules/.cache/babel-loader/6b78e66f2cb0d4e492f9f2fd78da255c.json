{"ast":null,"code":"import { REVIEW_ACTIONS } from \"../actions\";\nimport { failLoading, startLoading, successLoading } from \"../actions\";\nimport { normolize } from \"../../utils/normolize\";\nimport { selectReviewsIds } from \"../selectors\";\nimport { selectReviewsByRestaurantId } from \"../../restaurant/selectors\";\nimport { loadReviews, reviewSlice } from \"..\";\nexport const loadReviewsIfNotExist = store => next => action => {\n  if (action.type !== loadReviews.type) {\n    next(action);\n    return;\n  }\n\n  const restaurantReviewIds = selectReviewsByRestaurantId(store.getState(), {\n    restaurantId: action.payload\n  });\n  const loadedReviewIds = selectReviewsIds(store.getState()) || [];\n\n  if (restaurantReviewIds !== null && restaurantReviewIds !== void 0 && restaurantReviewIds.every(restaurantReviewId => loadedReviewIds.includes(restaurantReviewId))) {\n    return;\n  }\n\n  store.dispatch(startLoading());\n  fetch(`http://localhost:3001/api/reviews?id=${action.payload}`).then(response => response.json()).then(reviews => {\n    console.log(reviews);\n    store.dispatch(successLoading(normolize(reviews)));\n  }).catch(() => {\n    console.log(\"error\");\n    store.dispatch(failLoading());\n  });\n};","map":{"version":3,"names":["REVIEW_ACTIONS","failLoading","startLoading","successLoading","normolize","selectReviewsIds","selectReviewsByRestaurantId","loadReviews","reviewSlice","loadReviewsIfNotExist","store","next","action","type","restaurantReviewIds","getState","restaurantId","payload","loadedReviewIds","every","restaurantReviewId","includes","dispatch","fetch","then","response","json","reviews","console","log","catch"],"sources":["/Users/Arina.Karmanova/Documents/react-2022-09-22/src/store/review/middlewares/loadReviewsIfNotExist.js"],"sourcesContent":["import { REVIEW_ACTIONS } from \"../actions\";\nimport { failLoading, startLoading, successLoading } from \"../actions\";\nimport { normolize } from \"../../utils/normolize\";\nimport { selectReviewsIds } from \"../selectors\";\nimport { selectReviewsByRestaurantId } from \"../../restaurant/selectors\";\nimport { loadReviews, reviewSlice } from \"..\";\n\nexport const loadReviewsIfNotExist = (store) => (next) => (action) => {\n  if (action.type !== loadReviews.type) {\n    next(action);\n    return;\n  }\n\n  const restaurantReviewIds = selectReviewsByRestaurantId(store.getState(), {\n    restaurantId: action.payload,\n  });\n  const loadedReviewIds = selectReviewsIds(store.getState()) || [];\n\n  if (\n    restaurantReviewIds?.every((restaurantReviewId) =>\n      loadedReviewIds.includes(restaurantReviewId)\n    )\n  ) {\n    return;\n  }\n\n  store.dispatch(startLoading());\n\n  fetch(`http://localhost:3001/api/reviews?id=${action.payload}`)\n    .then((response) => response.json())\n    .then((reviews) => {\n      console.log(reviews);\n      store.dispatch( successLoading(normolize(reviews)));\n    })\n    .catch(() => {\n      console.log(\"error\");\n      store.dispatch(failLoading());\n    });\n};\n"],"mappings":"AAAA,SAASA,cAAT,QAA+B,YAA/B;AACA,SAASC,WAAT,EAAsBC,YAAtB,EAAoCC,cAApC,QAA0D,YAA1D;AACA,SAASC,SAAT,QAA0B,uBAA1B;AACA,SAASC,gBAAT,QAAiC,cAAjC;AACA,SAASC,2BAAT,QAA4C,4BAA5C;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,IAAzC;AAEA,OAAO,MAAMC,qBAAqB,GAAIC,KAAD,IAAYC,IAAD,IAAWC,MAAD,IAAY;EACpE,IAAIA,MAAM,CAACC,IAAP,KAAgBN,WAAW,CAACM,IAAhC,EAAsC;IACpCF,IAAI,CAACC,MAAD,CAAJ;IACA;EACD;;EAED,MAAME,mBAAmB,GAAGR,2BAA2B,CAACI,KAAK,CAACK,QAAN,EAAD,EAAmB;IACxEC,YAAY,EAAEJ,MAAM,CAACK;EADmD,CAAnB,CAAvD;EAGA,MAAMC,eAAe,GAAGb,gBAAgB,CAACK,KAAK,CAACK,QAAN,EAAD,CAAhB,IAAsC,EAA9D;;EAEA,IACED,mBADF,aACEA,mBADF,eACEA,mBAAmB,CAAEK,KAArB,CAA4BC,kBAAD,IACzBF,eAAe,CAACG,QAAhB,CAAyBD,kBAAzB,CADF,CADF,EAIE;IACA;EACD;;EAEDV,KAAK,CAACY,QAAN,CAAepB,YAAY,EAA3B;EAEAqB,KAAK,CAAE,wCAAuCX,MAAM,CAACK,OAAQ,EAAxD,CAAL,CACGO,IADH,CACSC,QAAD,IAAcA,QAAQ,CAACC,IAAT,EADtB,EAEGF,IAFH,CAESG,OAAD,IAAa;IACjBC,OAAO,CAACC,GAAR,CAAYF,OAAZ;IACAjB,KAAK,CAACY,QAAN,CAAgBnB,cAAc,CAACC,SAAS,CAACuB,OAAD,CAAV,CAA9B;EACD,CALH,EAMGG,KANH,CAMS,MAAM;IACXF,OAAO,CAACC,GAAR,CAAY,OAAZ;IACAnB,KAAK,CAACY,QAAN,CAAerB,WAAW,EAA1B;EACD,CATH;AAUD,CA/BM"},"metadata":{},"sourceType":"module"}